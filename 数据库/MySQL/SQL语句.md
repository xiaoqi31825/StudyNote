# SQL语句## 0、概述- SQL语句分类：数据查询、数据定义、数据操纵、数据控制、事务控制、系统管理、数据库管理、视图管理、函数管理、存储过程管理、触发器管理、事件管理、权限管理、其他语句- 书写规则: SQL语句不区分大小写, 但建议书写标准SQL语句, 请遵循以下规则:  - SQL关键字大写  - 列名和表名小写  - 默认值使用单引号''- 参考书籍: 《数据库系统原理》P85-123- 中文参考文档: https://mysql.nqsu.com/251.html## 1、数据查询- 缩写: DQ语句- 用于: 从数据库中查询(SELECT)数据,并返回结果。- 最基本的SQL语句: 只对数据进行查询,不会对数据进行修改。- 常见语句: 如下### SELECT语句- 执行过程: 从数据库中选取匹配的特定行和列, 将这些数据组织成一个结果集, 然后以一张临时表的形式返回。- `SELECT`后面: 表示的是要返回的列名, 有几个列名就表示会返回几列。- `WHERE`后面: 表示的是条件过滤, 即对查询结果进行过滤。- `ON`后面: 表示的是连接条件, 即指定连接的列。- `ORDER BY`后面: 表示的是排序, 即对查询结果进行排序。- `LIMIT`后面: 表示的是限制返回的结果数量, 即限制返回的行数。- `UNION`后面: 表示的是合并查询结果, 即将多个查询结果合并成一个结果集。#### 所有列 | 指定数据表: *```mysqlSELECT * FROM customers;``````mysqlSELECT * FROM customers \G;```- \G: 分行显示#### 指定列: 列名```mysqlSELECT cust_name, cust_city FROM customers;```#### 列别名: AS```mysqlSELECT cust_name AS 名字, cust_city AS 城市 FROM customers;```#### 列值匹配 | 条件过滤: WHERE```mysqlSELECT * FROM customersWHERE cust_city='Beijing';```#### 列值替换: CASE```mysqlSELECT cust_name,CASE WHEN sex='M' THEN'女'ELSE '男'END AS 性别FROM customers;```- 翻译: 查询customers表中cust_name列, 并将性别M替换为'女', 否则为'男', 并将结果别名为性别列返回。#### 列值运算: +、-、*、/、%```mysqlSELECT cust_id+100 AS IDFROM customers;```- 翻译: 把cust_id列的值加100, 并将结果别名为ID列返回。#### 列值去重: DISTINCT- 适用范围: 所有聚合函数```mysqlSELECT DISTINCT cust_city, cust_age FROM customers;```- 翻译: 查询customers表中cust_city列+cust_age列不重复的行。#### 聚合函数##### 统计条目数: COUNT```mysqlSELECT COUNT(*) FROM customers;```- 翻译: 统计customers表中所有行的数量 -- (包括NULL值的行)```mysqlSELECT COUNT(sex) FROM customers; ```- 翻译: 统计customers表中sex列的非空值数量 --- (不包括NULL值的行)##### 求和: SUM- 适用范围: 仅数值类型(不适用于日期、字符串等类型)```mysqlSELECT SUM(cust_age) FROM customers;``````mysqlSELECT SUM(DISTINCT cust_age) FROM customers;``````mysqlSELECT SUM(cust_id), SUM(cust_age) FROM customers;``````mysqlSELECT SUM(cust_age) / COUNT(*) FROM customers;```- 翻译: 计算customers表中cust_age列的总和除以总行数。```mysql```##### 最大值: MAX、最小值: MIN- 适用范围: 所有数据类型```mysqlSELECT MAX(cust_id), MIN(cust_age) FROM customers;```##### 平均值: AVG```mysqlSELECT AVG(cust_id) FROM customers;```- 翻译: 计算customers表中cust_id列的平均值。### FORM子句 (多表连接查询)- `FROM`后面: 表示的是数据源, 即从哪张表中查询数据。 表名必须存在, 否则会报错。- `JOIN`后面: 表示的是多表查询, 即查询多个表的数据。- 注意: 表的顺序很重要, 否则会报错; 列名不能重复, 否则会报错; 列的数据类型必须一致, 否则会报错#### 交叉连接: CROSS JOIN- 又称为笛卡尔积, 即将两个表的所有行组合成一个结果集, 如: A(a1,a2), B(b1,b2) => AxB(a1,a2,b1,b2)```mysqlSELECT * FROM customers CROSS JOIN order1;```- 翻译: 查询customers表和order1表的笛卡尔积, 即返回所有客户和所有订单的组合。#### 内连接: INNER JOIN##### 等值连接: ON##### 非等值连接: USING##### 自连接: NATURAL JOIN#### 外连接: LEFT JOIN##### 左外连接: LEFT OUTER JOIN- 也称:左连接- 左表为基表，右表为参数表，如果右表没有与左表对应的内容，则显示为NULL。```mysqlSELECT * FROM customers LEFT JOIN order1ON customers.cust_id = order1.cust_id;```##### 右外连接: RIGHT OUTER JOIN- 也称:右连接- 右表为基表，左表为参数表，如果左表没有与右表对应的内容，则显示为NULL。### WHERE子句 (条件查询)#### 比较运算```mysqlSELECT * FROM customersWHERE cust_id=901;```- 翻译: 查询customers表中cust_id列的值等于901的所有行。#### 判定范围##### 范围区间: BETWEEN...AND ```mysqlSELECT * FROM customersWHERE cust_id BETWEEN 901 AND 905;```- 翻译: 查询customers表中cust_id列的值在901到905之间的所有行。##### 枚举: IN```mysqlSELECT * FROM customersWHERE cust_id IN (901, 903, 905);```- 翻译: 查询customers表中cust_id列的值在901、903、905之间的所有行。#### 判定空值##### 不为空: IS NOT NULL##### 为空: IS NULL```mysqlSELECT * FROM customersWHERE cust_age IS NULL;```- 翻译: 查询customers表中cust_age列的值为空的所有行。#### 子查询##### 表子查询##### 行子查询##### 列子查询##### 标量子查询### GROUP BY子句 (分组数据)### HAVING子句 (过滤分组)### ORDER BY子句 (排序数据)### LIMIT子句 (限制返回结果数量)## 2、数据定义- 缩写: DD语句- 用于: 定义和管理数据库及数据库对象- 最复杂的SQL语句: 涉及数据库对象(模式、表、索引、视图、触发器、存储过程、函数)等操作。- 常见语句: 创建(CREATE)、修改(ALTER)、删除(DROP)等。### 数据库- DATABASE- 又称:模式(SCHEMA)#### 查询##### 数据库版本```mysqlSELECT VERSION();```##### 数据库字符集```mysqlSHOW VARIABLES LIKE 'char%';```##### 数据库排序规则```mysql SHOW VARIABLES LIKE 'collate%';```##### 数据库创建时间```mysqlSHOW CREATE DATABASE db_course_demo;`````##### 数据库当前时间```mysqlSELECT NOW();```##### 数据库列表```mysqlSHOW DATABASES;```##### 选择数据库```mysqlUSE db_course_demo;```##### 当前使用的数据库```mysqlSELECT DATABASE();```#### 创建##### 创建数据库: CREATE DATABASE```mysqlCREATE DATABASE IF NOT EXISTS db_course_demoDEFAULT CHARSET utf8 DEFAULT COLLATE utf8_general_ci; ```- 翻译: 如果不存在名为db_course_demo的数据库, 则创建db_course_demo数据库, 默认字符集为utf8, 排序规则为utf8_general_ci。#### 修改##### 修改数据库: ALTER DATABASE```mysqlALTER DATABASE db_course_demoDEFAULT CHARSET utf8mb4;```- 翻译: 修改db_course_demo数据库的默认字符集为utf8mb4。#### 删除##### 删除数据库: DROP DATABASE```mysqlDROP DATABASE IF EXISTS db_course_demo;```- 翻译: 删除名为db_course_demo的数据库。- 注意: 	- 如果不加`IF EXISTS`: 当实际数据库不存在名为db_course_demo的数据库, 会返回报错。加上IF EXISTS: 如果不存在此数据库不会报错。	- 数据库删除后, 该数据库下的所有数据也会被删除, 故谨慎操作。### 数据表#### 查询##### 查询所有数据表```mysqSHOW TABLES;```##### 查询表sql语句```mysqlSHOW CREATE TABLE customers;```##### 查询表结构: 三种方式```mysqlDESC customers;``````mysql  DESCRIBE customers;``````mysqlSHOW COLUMNS FROM customers;```#### 创建##### 创建表: CREATE TABLE```mysqlCREATE TABLE table_name (	字段名1 数据类型 [列级完整性约束条件] [默认值],	字段名2 数据类型 [列级完整性约束条件] [默认值],	...	[,表级完整性约束条件])[ENGINE=引擎类型];```###### 表1: customers(客户表)```mysqlCREATE TABLE customers(cust_id INT NOT NULL AUTO_INCREMENT,cust_name CHAR(50) NOT NULL,cust_sex INT NOT NULL DEFAULT 0,cust_address CHAR(50) NULL,PRIMARY KEY(cust_id));```- 翻译:	- 关键字`TEMPORARY`: 若没有该关键字, 则表示创建的是持久表(会一直存在,对多个用户可见), 否则为临时表(会随着会话结束而消失,仅对创建的它的用户可见)	- `cust_id`: 客户ID, 整型, 不为空, 自增主键 (`AUTO_INCREMENT`: 起始值为1, 步长为1, 无最大值, 唯一不重复, 必须被索引,可以被覆盖)	- `cust_name`: 客户姓名, 字符类型, 最大长度为50, 不为空 (`NOT NULL`: 值不为空, 每列必须设置NULL或NOT NULL,如果不设置则为NULL)	- `cust_sex`: 客户性别, 整型, 默认值为0 (`DEFAULT`: 如果插入数据时不指定该列的值, 则使用默认值)	- `cust_address`: 客户地址, 字符类型, 最大长度为50, 可以为空	- 关键字`PRIMARY KEY`: 主键 (必须唯一, 列必须为NOT NULL, 添加主键:`ADD PRIMARY KEY`、删除主键:`DROP PRIMARY KEY`)	- 关键字`ENGINE`: 引擎类型, 默认为InnoDB, 一般不用指定。###### 表2: order1(订单表)- 注意: `order`是排序的关键字, 不能作为表名, 否则`SELECT * FROM order` 会报错。```mysqlCREATE TABLE `order1` (`order_id` int(11) NOT NULL AUTO_INCREMENT,`order_product` char(50) NOT NULL,`order_product_type` char(50) NOT NULL,`cust_id` int(11) NOT NULL,`order_date` datetime NOT NULL,`order_amount` int(11) NOT NULL,PRIMARY KEY (`order_id`),KEY `cust_id` (`cust_id`),CONSTRAINT `order1_ibfk_1` FOREIGN KEY (`cust_id`) REFERENCES `customers` (`cust_id`)) ENGINE=InnoDB DEFAULT CHARSET=gb2312;```#### 修改##### 重命名表: RENAME TO | RENAME TABLE...TO````mysqlALTER TABLE customersRENAME TO customers_new;```````mysqlRENAME TABLE customers_new TO customers;```- 补充: `RENAME TABLE...TO`可以同时修改多个表名##### 重命名列: CHANGE COLUMN```mysqlALTER TABLE customersCHANGE COLUMN cust_sex sex char(1) NULL DEFAULT 'M';```- 翻译: 修改customers表中`cust_sex`列的名称为`sex`, 并将其数据类型修改为char(1), 允许为空, 默认值为'M'。##### 添加列: ADD COLUMN```mysqlALTER TABLE customersADD COLUMN cust_city char(10) NOT NULL DEFAULT 'Wuhan' AFTER sex;  ```- 翻译: 在customers表中, 在`cust_sex`列之后, 添加`cust_city`列, 类型为char(10), 默认值为'Wuhan'。- 关键字`AFTER`: 表示插入的新列位于xxx列之后。- 关键字`FIRST`: 表示插入的新列位于表的最前面。(若没有这2个关键字, 则默认位于最后面)- 注意: 关键字`BEFORE`(表示插入的新列位于xxx列之前)已废弃, 使用会报错。##### 添加外键: ADD FOREIGN KEY##### 修改列的默认值: ALTER COLUMN...SET DEFAULT```mysqlALTER TABLE customersALTER COLUMN cust_city SET DEFAULT 'Beijing';```- 翻译: 修改customers表中`cust_city`列的默认值为'Beijing'。##### 修改列的数据类型: MODIFY COLUMN```mysqlALTER TABLE customersMODIFY COLUMN cust_name char(20) FIRST;```- 翻译: 修改customers表中`cust_name`列的数据类型为char(20), 并将其移动到表的最前面。#### 删除##### 删除外键: DROP FOREIGN KEY##### 删除列: DROP COLUMN子句```mysqlALTER TABLE customersDROP COLUMN cust_address;```- 翻译: 删除customers表中的`cust_address`列。##### 删除表: DROP TABLE```mysqlDROP TABLE IF EXISTS customers;```- 注意:	- 可以同时删除多个表(包括临时表), 如: `DROP TABLE `table1`, `table2`, `table3`;`	- 当表被删除后, 该表下的所有数据和分区信息也会被删除, 故谨慎操作。### 索引- 三类索引:	- 普通索引: 普通列上创建索引, 索引名为`index_name`, 关键字`INDEX`	- 唯一索引: 唯一列上创建索引, 唯一且非空, 索引名为`index_name`, 关键字`UNIQUE`	- 主键索引: 主键列上创建索引, 唯一且非空, 索引名为`PRIMARY`, 关键字`PRIMARY KEY`  #### 查询##### 索引列表: SHOW INDEX```mysqlSHOW INDEX FROM customers;```#### 创建##### 写法一: CREATE INDEX...ON```mysqlCREATE INDEX index_customersON customers(cust_name(3) ASC);```- 翻译: 在`customers`表上,根据`cust_name`列的前3个字符,创建名为`index_customers`的索引,排序方式为升序。- 关键字`UNIQUE`: 用于指定唯一性索引 (添加唯一索引:`ADD UNIQUE INDEX`、删除唯一索引:`DROP INDEX`)- 关键字`ASC`: 升序, 默认是升序- 关键字`DESC`: 降序- 补充: 该语句不能创建主键; 一个表可以创建多个索引,但索引名必须唯一; ##### 写法二: CREATE TABLE...PRIMARY KEY```mysqlCREATE TABLE customers(cust_id INT NOT NULL AUTO_INCREMENT,cust_name CHAR(50) NOT NULL,cust_sex INT NOT NULL DEFAULT 0,cust_address CHAR(50) NULL,PRIMARY KEY(cust_id));```##### 写法三: ALTER TABLE...ADD INDEX```mysqlALTER TABLE customersADD INDEX index_customers(cust_name(3) ASC)```#### 删除##### 写法一：DROP INDEX```mysqlDROP INDEX index_customers ON customers;```##### 写法二：ALTER TABLE...DROP INDEX```mysqlALTER TABLE customersDROP index_customers;```### 视图#### 创建视图: CREATE VIEW```mysqlCREATE VIEW customers_view ASSELECT * FROM customersWHERE cust_age > 30WITH CHECK OPTION;```- 翻译: 创建名为`customers_view`的视图, 条件语句为`SELECT * FROM customers WHERE cust_age > 30`, 并设置`WITH CHECK OPTION`选项, 即对视图的修改必满足此条件语句。#### 查询视图: SHOW CREATE VIEW```mysqlSHOW CREATE VIEW customers_view;```#### 修改视图##### 修改视图定义: ALTER VIEW##### 修改视图数据###### 插入数据: INSERT###### 更新数据: UPDATE###### 删除数据: DELETE#### 删除视图: DROP VIEW```mysqlDROP VIEW customers_view;```### 存储过程#### 创建存储过程: CREATE PROCEDURE##### 修改结束标示: DELIMITER```mysqlDELIMITER //```- 翻译: 修改结束标示符为`//`- 注意: 结束标示符必须为`//`, 否则会报错。##### 存储过程体###### 局部变量: DECLARE- 局部变量赋值: SET- 选定列的值直接存储到局部变量: SELECT...INTO######  流程控制语句- 条件判断语句: IF...THEN...ELSE、CASE- 循环语句: WHILE、REPEAT、LOOP###### 游标- 声明游标: DECLARE CURSOR- 打开游标: OPEN CURSOR- 读取游标: FETCH...INTO- 关闭游标: CLOSE CURSOR#### 调用存储过程: CALL#### 删除存储过程: DROP PROCEDURE### 存储函数#### 创建存储函数: CREATE FUNCTION#### 调用存储函数: SELECT#### 删除存储函数: DROP FUNCTION### 触发器#### 创建触发器: CREATE TRIGGER#### 删除触发器: DROP TRIGGER#### 使用触发器: INSERT、UPDATE、DELETE## 3、数据操纵- 缩写:DM语句- 用于: 操作数据库中的数据- 常见语句: 插入(INSERT)、更新(UPDATE)、删除(DELETE)等。### 插入数据: INSERT#### 行数据: INSERT INTO...VALUES##### 单行数据- 注意: 列名和值,及值的顺序, 必须一一对应, 否则会报错。```mysqlINSERT INTO customersVALUES ('张三', 901, 'F', '北京市');``````mysqlINSERT INTO customers (cust_name, cust_id, sex, cust_city)VALUES ('小七', 902, 'M', '深圳市');```##### 多行数据```mysqlINSERT INTO customersVALUES ('小红', 903, 'M', '上海市'), ('小明', 904, 'F', '长沙市');``````mysqlINSERT INTO order1VALUES (1, '手机', '苹果', 901, '2021-01-01 10:00:00', 1000), (2, '电脑', '华为', 902, '2021-01-02 10:00:00', 2000), (3, '书籍', '京东', 903, '2021-01-03 10:00:00', 3000), (4, '衣服', '淘宝', 904, '2021-01-04 10:00:00', 4000);```#### 列数据: INSERT INTO...SET##### 单列数据```mysqlINSERT INTO customersSET cust_name = '王五';```##### 多列数据```mysqlINSERT INTO customersSET cust_name = '李四', cust_city = '上海市';```- 翻译: 向`customers`表中cust_name列、cust_city列插入数据- 补充: 实际上就是新增了一行数据,未设置的列,则使用默认值或NULL值。- 注意: 若插入的列名不在表中, 则会报错。#### 子查询数据: INSERT INTO...SELECT```mysqlINSERT INTO customersSELECT cust_name, cust_id, sex, cust_cityFROM orders;```- 翻译: 将`orders`表中的数据插入到`customers`表中。### 修改数据: UPDATE```mysqlUPDATE customersSET sex = 'M'WHERE cust_id = 903;``````mysql UPDATE customersSET cust_name = '小五'WHERE cust_id = 903; ``````mysqlUPDATE customersSET cust_age=31WHERE cust_id = 902;```- 翻译: 更新`customers`表中`cust_id`为902的`cust_age`列值为31。### 删除数据: DELETE```DELETE FROM customersWHERE cust_id = 901;```## 4、数据控制- 缩写: DC语句- 以控制用户的访问权限为主。- 用于: 安全管理(包括用户管理、权限管理、安全审计、密码管理等)## 5、事务控制- 缩写: TTC语句- 用于: 事务处理(包括事务开始、提交、回滚等)- 事务: 一个或一组SQL语句组成的工作单元, 要么全部执行成功, 要么全部失败。- 事务的特性: 原子性、一致性、隔离性、持久性。- 事务控制语句: 事务开始(START TRANSACTION)、事务提交(COMMIT)、事务回滚(ROLLBACK)。## 6、系统管理- 缩写: SM语句## 7、数据库管理- 缩写: DB语句## 8、视图管理- 缩写: VW语句## 9、函数管理- 缩写: FN语句## 10、存储过程管理- 缩写: SP语句## 11、触发器管理- 缩写: TR语句## 12、事件管理- 缩写: EV语句## 13、权限管理- 缩写: PM语句## 14、其他语句