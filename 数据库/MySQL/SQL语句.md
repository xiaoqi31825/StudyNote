# SQL语句## 0、概述- SQL语句分类：数据查询、数据定义、数据操纵、数据控制、事务控制、系统管理、数据库管理、视图管理、函数管理、存储过程管理、触发器管理、事件管理、权限管理、其他语句- 书写规则: SQL语句不区分大小写, 但建议书写标准SQL语句, 请遵循以下规则:  - SQL关键字大写  - 列名和表名小写  - 默认值使用单引号''  ~~- 常量(如表名、列名)使用反引号``~~- 参考书籍: 《数据库系统原理》P85-123- 中文参考文档: https://mysql.nqsu.com/251.html## 1、数据查询(DQ)语句- 用于: 从数据库中查询(SELECT)数据,并返回结果。- 最基本的SQL语句: 只对数据进行查询,不会对数据进行修改。- 常见语句: 查询(SELECT)、WHERE、ORDER BY、LIMIT、JOIN、UNION等子查询。### SELECT语句- 执行过程: 从数据库中选取匹配的特定行和列, 将这些数据组织成一个结果集, 然后以一张临时表的形式返回。#### 查询所有列|查询指定数据表```mysqlSELECT * FROM customers;```#### 查询指定列```mysqlSELECT cust_name, cust_city FROM customers;```#### 查询 使用别名 返回指定列```mysqlSELECT cust_name AS 名字, cust_city AS 城市 FROM customers;```#### 查询 替换 使用别名 返回指定列```mysqlSELECT cust_name,CASE WHEN sex='M' THEN'男'ELSE '女'END AS 性别FROM customers;```#### 查询 计算列值```mysqlSELECT cust_id+100 AS IDFROM customers;```#### 聚合函数## 2、数据定义(DD)语句- 用于: 定义和管理数据库及数据库对象- 最复杂的SQL语句: 涉及数据库对象(模式、表、索引、视图、触发器、存储过程、函数)等操作。- 常见语句: 创建(CREATE)、修改(ALTER)、删除(DROP)等。### 数据库(DATABASE) | 模式(SCHEMA)#### 查询##### 查询数据库版本```mysqlSELECT VERSION();```##### 查询数据库字符集```mysqlSHOW VARIABLES LIKE 'char%';```##### 查询数据库排序规则```mysql SHOW VARIABLES LIKE 'collate%';```##### 查询数据库创建时间```mysqlSHOW CREATE DATABASE db_course_demo;`````##### 查询数据库当前时间```mysqlSELECT NOW();```##### 查询数据库列表```mysqlSHOW DATABASES;```##### 选择数据库```mysqlUSE db_course_demo;```##### 查询当前使用的数据库```mysqlSELECT DATABASE();```#### 创建##### 创建数据库: CREATE DATABASE```mysqlCREATE DATABASE IF NOT EXISTS db_course_demoDEFAULT CHARSET utf8 DEFAULT COLLATE utf8_general_ci; ```- 翻译: 如果不存在名为db_course_demo的数据库, 则创建db_course_demo数据库, 默认字符集为utf8, 排序规则为utf8_general_ci。#### 修改##### 修改数据库: ALTER DATABASE```mysqlALTER DATABASE db_course_demoDEFAULT CHARSET utf8mb4;```- 翻译: 修改db_course_demo数据库的默认字符集为utf8mb4。#### 删除##### 删除数据库: DROP DATABASE```mysqlDROP DATABASE IF EXISTS db_course_demo;```- 翻译: 删除名为db_course_demo的数据库。- 注意: 	- 如果不加`IF EXISTS`: 当实际数据库不存在名为db_course_demo的数据库, 会返回报错。加上IF EXISTS: 如果不存在此数据库不会报错。	- 数据库删除后, 该数据库下的所有数据也会被删除, 故谨慎操作。### 数据表#### 查询##### 查询所有数据表```mysqSHOW TABLES;```##### 查询表sql语句```mysqlSHOW CREATE TABLE customers;```##### 查询表结构: 三种方式```mysqlDESC customers;``````mysql  DESCRIBE customers;``````mysqlSHOW COLUMNS FROM customers;```#### 创建##### 创建表: CREATE TABLE```mysqlCREATE TABLE table_name (	字段名1 数据类型 [列级完整性约束条件] [默认值],	字段名2 数据类型 [列级完整性约束条件] [默认值],	...	[,表级完整性约束条件])[ENGINE=引擎类型];``````mysqlCREATE TABLE customers(cust_id INT NOT NULL AUTO_INCREMENT,cust_name CHAR(50) NOT NULL,cust_sex INT NOT NULL DEFAULT 0,cust_address CHAR(50) NULL,PRIMARY KEY(cust_id));```- 翻译:	- 关键字`TEMPORARY`: 若没有该关键字, 则表示创建的是持久表(会一直存在,对多个用户可见), 否则为临时表(会随着会话结束而消失,仅对创建的它的用户可见)	- `cust_id`: 客户ID, 整型, 不为空, 自增主键 (`AUTO_INCREMENT`: 起始值为1, 步长为1, 无最大值, 唯一不重复, 必须被索引,可以被覆盖)	- `cust_name`: 客户姓名, 字符类型, 最大长度为50, 不为空 (`NOT NULL`: 值不为空, 每列必须设置NULL或NOT NULL,如果不设置则为NULL)	- `cust_sex`: 客户性别, 整型, 默认值为0 (`DEFAULT`: 如果插入数据时不指定该列的值, 则使用默认值)	- `cust_address`: 客户地址, 字符类型, 最大长度为50, 可以为空	- 关键字`PRIMARY KEY`: 主键 (必须唯一, 列必须为NOT NULL, 添加主键:`ADD PRIMARY KEY`、删除主键:`DROP PRIMARY KEY`)	- 关键字`ENGINE`: 引擎类型, 默认为InnoDB, 一般不用指定。#### 修改##### 重命名表: RENAME TO | RENAME TABLE...TO````mysqlALTER TABLE customersRENAME TO customers_new;```````mysqlRENAME TABLE customers_new TO customers;```- 补充: `RENAME TABLE...TO`可以同时修改多个表名##### 重命名列: CHANGE COLUMN```mysqlALTER TABLE customersCHANGE COLUMN cust_sex sex char(1) NULL DEFAULT 'M';```- 翻译: 修改customers表中`cust_sex`列的名称为`sex`, 并将其数据类型修改为char(1), 允许为空, 默认值为'M'。##### 添加列: ADD COLUMN```mysqlALTER TABLE customersADD COLUMN cust_city char(10) NOT NULL DEFAULT 'Wuhan' AFTER cust_sex;  ```- 翻译: 在customers表中, 在`cust_sex`列之后, 添加`cust_city`列, 类型为char(10), 默认值为'Wuhan'。- 关键字`AFTER`: 表示插入的新列位于xxx列之后。- 关键字`FIRST`: 表示插入的新列位于表的最前面。(若没有这2个关键字, 则默认位于最后面)##### 添加外键: ADD FOREIGN KEY##### 修改列的默认值: ALTER COLUMN...SET DEFAULT```mysqlALTER TABLE customersALTER COLUMN cust_city SET DEFAULT 'Beijing';```- 翻译: 修改customers表中`cust_city`列的默认值为'Beijing'。##### 修改列的数据类型: MODIFY COLUMN```mysqlALTER TABLE customersMODIFY COLUMN cust_name char(20) FIRST;```- 翻译: 修改customers表中`cust_name`列的数据类型为char(20), 并将其移动到表的最前面。#### 删除##### 删除外键: DROP FOREIGN KEY##### 删除列: DROP COLUMN子句```mysqlALTER TABLE customersDROP COLUMN cust_address;```- 翻译: 删除customers表中的`cust_address`列。##### 删除表: DROP TABLE```mysqlDROP TABLE IF EXISTS customers;```- 注意:	- 可以同时删除多个表(包括临时表), 如: `DROP TABLE `table1`, `table2`, `table3`;`	- 当表被删除后, 该表下的所有数据和分区信息也会被删除, 故谨慎操作。### 索引- 三类索引:	- 普通索引: 普通列上创建索引, 索引名为`index_name`, 关键字`INDEX`	- 唯一索引: 唯一列上创建索引, 唯一且非空, 索引名为`index_name`, 关键字`UNIQUE`	- 主键索引: 主键列上创建索引, 唯一且非空, 索引名为`PRIMARY`, 关键字`PRIMARY KEY`  #### 查询##### 查询索引列表: SHOW INDEX```mysqlSHOW INDEX FROM customers;```#### 创建##### 创建索引写法一: CREATE INDEX...ON```mysqlCREATE INDEX index_customersON customers(cust_name(3) ASC);```- 翻译: 在`customers`表上,根据`cust_name`列的前3个字符,创建名为`index_customers`的索引,排序方式为升序。- 关键字`UNIQUE`: 用于指定唯一性索引 (添加唯一索引:`ADD UNIQUE INDEX`、删除唯一索引:`DROP INDEX`)- 关键字`ASC`: 升序, 默认是升序- 关键字`DESC`: 降序- 补充: 该语句不能创建主键; 一个表可以创建多个索引,但索引名必须唯一; ##### 创建索引写法二: CREATE TABLE...PRIMARY KEY```mysqlCREATE TABLE customers(cust_id INT NOT NULL AUTO_INCREMENT,cust_name CHAR(50) NOT NULL,cust_sex INT NOT NULL DEFAULT 0,cust_address CHAR(50) NULL,PRIMARY KEY(cust_id));```##### 创建索引写法三: ALTER TABLE...ADD INDEX```mysqlALTER TABLE customersADD INDEX index_customers(cust_name(3) ASC)```#### 删除##### 删除索引写法一：DROP INDEX```mysqlDROP INDEX index_customers ON customers;```##### 删除索引写法二：ALTER TABLE...DROP INDEX```mysqlALTER TABLE customersDROP index_customers;```### 视图### 触发器### 存储过程### 函数## 3、数据操纵(DM)语句- 用于: 操作数据库中的数据- 常见语句: 插入(INSERT)、更新(UPDATE)、删除(DELETE)等。### 插入数据: INSERT#### 插入单行或多行数据: INSERT INTO...VALUES```mysqlINSERT INTO customersVALUES ('张三', 901, 'F', '北京市');``````mysqlINSERT INTO customers (cust_name, cust_id, sex, cust_city)VALUES ('小七', 902, 'M', '深圳市');```#### 插入部分列值数据: INSERT INTO...SET```mysqlINSERT INTO customersSET cust_name = '李四', cust_city = '上海市';```#### 插入子查询数据: INSERT INTO...SELECT```mysqlINSERT INTO customersSELECT cust_name, cust_id, sex, cust_cityFROM orders;```- 翻译: 将`orders`表中的数据插入到`customers`表中。### 修改数据: UPDATE```mysqlUPDATE customersSET sex = 'F'WHERE cust_id = 902;```### 删除数据: DELETE```DELETE FROM customersWHERE cust_id = 901;```## 4、数据控制(DC)语句- 以控制用户的访问权限为主。- 用于: 安全管理(包括用户管理、权限管理、安全审计、密码管理等)## 5、事务控制(TC)语句- 用于: 事务处理(包括事务开始、提交、回滚等)- 事务: 一个或一组SQL语句组成的工作单元, 要么全部执行成功, 要么全部失败。- 事务的特性: 原子性、一致性、隔离性、持久性。- 事务控制语句: 事务开始(START TRANSACTION)、事务提交(COMMIT)、事务回滚(ROLLBACK)。## 6、系统管理(SM)语句## 7、数据库管理(DB)语句## 8、视图管理(VW)语句## 9、函数管理(FN)语句## 10、存储过程管理(SP)语句## 11、触发器管理(TR)语句## 12、事件管理(EV)语句## 13、权限管理(PM)语句## 14、其他语句